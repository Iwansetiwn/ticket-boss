(()=>{var e={};e.id=5505,e.ids=[5505],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12909:(e,t,r)=>{"use strict";r.d(t,{C0:()=>p,HW:()=>d,IX:()=>o,jw:()=>u,lx:()=>l,uv:()=>c});var n=r(44999),s=r(61120),a=r(55511),i=r(31183);let o="session-token";async function u(e){let t=(0,a.randomBytes)(32).toString("hex"),r=new Date(Date.now()+6048e5);return await i.A.session.create({data:{token:t,userId:e,expiresAt:r}}),{token:t,expiresAt:r}}async function l(e){e&&await i.A.session.deleteMany({where:{token:e}})}let d=(0,s.cache)(async()=>{let e=await (0,n.UL)(),t=e.get(o)?.value;if(!t)return null;let r=await i.A.session.findUnique({where:{token:t},include:{user:!0}});if(!r)return null;if(r.expiresAt.getTime()<Date.now())return await i.A.session.delete({where:{id:r.id}}),null;let s=r.user;return{id:s.id,email:s.email,name:s.name,firstName:s.firstName??null,lastName:s.lastName??null,phone:s.phone??null,bio:s.bio??null,location:s.location??null,facebook:s.facebook??null,twitter:s.twitter??null,linkedin:s.linkedin??null,instagram:s.instagram??null,country:s.country??null,cityState:s.cityState??null,postalCode:s.postalCode??null,taxId:s.taxId??null,avatarUrl:s.avatarUrl??null}});function c(e,t,r){e.cookies.set({name:o,value:t,httpOnly:!0,secure:!0,sameSite:"lax",path:"/",expires:r})}function p(e){e.cookies.set({name:o,value:"",httpOnly:!0,secure:!0,sameSite:"lax",path:"/",expires:new Date(0)})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(96330);let s=global.prisma??new n.PrismaClient},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52822:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s});var n=r(97240);function s(e){let t=process.env.NEXT_PUBLIC_WORLDHOST_SUPPORT_INBOX_URL??"https://admin.worldhost.group/admin/support/inbox",r=(0,n.Zz)(e);return`${t.replace(/\/$/,"")}/${r}`}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},84528:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>m,serverHooks:()=>N,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{DELETE:()=>x,GET:()=>f,PATCH:()=>h});var s=r(96559),a=r(48088),i=r(37719),o=r(32190),u=r(31183),l=r(12909),d=r(52822);let c=new Set(["Open","Pending","In progress","Awaiting Response","Resolved","Closed"]),p=e=>{if("string"==typeof e){let t=e.trim();return t.length>0?t:null}if(null===e)return null};async function w(e,t){let r=await u.A.ticket.findUnique({where:{id:e},select:{ownerId:!0}});return r&&(!r.ownerId||r.ownerId===t)}async function f(e,t){let r=await (0,l.HW)();if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await t.params;if(!n)return o.NextResponse.json({error:"Invalid id"},{status:400});try{let e=await u.A.ticket.findUnique({where:{id:n}});if(!e||e.ownerId&&e.ownerId!==r.id)return o.NextResponse.json({error:"Not found"},{status:404});let t={...e,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()};return o.NextResponse.json({ticket:t})}catch(e){return console.error("fetch ticket error:",e),o.NextResponse.json({error:"Failed to fetch"},{status:500})}}async function x(e,t){let r=await (0,l.HW)();if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await t.params;if(!n)return o.NextResponse.json({error:"Invalid id"},{status:400});try{if(!await w(n,r.id))return o.NextResponse.json({error:"Not found"},{status:404});return await u.A.ticket.delete({where:{id:n}}),o.NextResponse.json({success:!0},{status:200})}catch(e){return console.error("delete ticket error:",e),o.NextResponse.json({error:"Failed to delete"},{status:500})}}async function h(e,t){let r;let n=await (0,l.HW)();if(!n)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{id:s}=await t.params;if(!s)return o.NextResponse.json({error:"Invalid id"},{status:400});try{r=await e.json()}catch{return o.NextResponse.json({error:"Invalid JSON payload"},{status:400})}try{if(!await w(s,n.id))return o.NextResponse.json({error:"Not found"},{status:404});let e={},t=p(r.clientName),a=p(r.brand),i=p(r.subject),l=p(r.status),f=p(r.issueCategory),x=p(r.ticketUrl),h=void 0===x?void 0:x??(0,d.Q)(s);if(void 0!==t&&(e.clientName=t??"Unknown"),void 0!==a&&(e.brand=a??"Unknown"),void 0!==i&&(e.subject=i??"Untitled"),void 0!==l){let t=l??"Open";if(!c.has(t))return o.NextResponse.json({error:"Invalid status"},{status:400});e.status=t}if(void 0!==f&&(e.issueCategory=f??"Uncategorized"),void 0!==h&&(e.ticketUrl=h),0===Object.keys(e).length)return o.NextResponse.json({error:"No updates supplied"},{status:400});let m=await u.A.ticket.update({where:{id:s},data:e});return o.NextResponse.json({success:!0,ticket:m})}catch(e){return console.error("update ticket error:",e),o.NextResponse.json({error:"Failed to update"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tickets/[id]/route",pathname:"/api/tickets/[id]",filename:"route",bundlePath:"app/api/tickets/[id]/route"},resolvedPagePath:"/Users/iwan/Downloads/New Chat/new-support/src/app/api/tickets/[id]/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:v,workUnitAsyncStorage:g,serverHooks:N}=m;function k(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:g})}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},97240:(e,t,r)=>{"use strict";r.d(t,{WU:()=>i,Zz:()=>a,av:()=>o,gA:()=>l,ho:()=>u});let n="__day__",s=/^\d{4}-\d{2}-\d{2}$/;function a(e){if(!e)return e;let t=e.trim(),r=t.lastIndexOf(n);if(-1===r)return t;let a=t.slice(r+n.length);return s.test(a)?t.slice(0,r):t}function i(e){if(e){let t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return new Date}function o(e){return e.toISOString().slice(0,10)}function u(e,t){let r=e.trim(),s=o(t);return`${r}${n}${s}`}function l(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),r=new Date(t);return r.setUTCDate(r.getUTCDate()+1),{start:t,end:r}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4447,4999,580],()=>r(84528));module.exports=n})();