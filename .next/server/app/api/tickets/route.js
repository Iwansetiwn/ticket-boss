(()=>{var e={};e.id=454,e.ids=[454],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(96330);let n=global.prisma??new s.PrismaClient},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51485:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>m,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>l,OPTIONS:()=>c,POST:()=>p});var n=r(96559),a=r(48088),i=r(37719),o=r(32190),u=r(31183);function d(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function c(){return d(new o.NextResponse(null,{status:204}))}async function p(e){let t=e.headers.get("authorization")?.replace("Bearer ",""),r=process.env.DASHBOARD_TOKEN;if(!t||t!==r)return d(o.NextResponse.json({error:"Unauthorized"},{status:401}));try{let t;let r=await e.json();if(!r.id||!r.brand)return d(o.NextResponse.json({error:"Missing required fields"},{status:400}));let s=r.clientName?.trim()||"Unknown",n=r.subject?.trim()||"Untitled",a=r.lastMessage??"";if(r.ownerId)t=r.ownerId;else if(r.ownerEmail){let e=await u.A.user.findUnique({where:{email:r.ownerEmail.toLowerCase().trim()},select:{id:!0}});t=e?.id}let i=await u.A.ticket.upsert({where:{id:r.id},update:{brand:r.brand,clientName:s,subject:n,product:r.product,status:r.status,lastMessage:a,date:r.date,clientMsgs:r.clientMsgs,agentMsgs:r.agentMsgs,...t?{ownerId:t}:{}},create:{id:r.id,brand:r.brand,clientName:s,subject:n,product:r.product,status:r.status,lastMessage:a,date:r.date,clientMsgs:r.clientMsgs,agentMsgs:r.agentMsgs,ownerId:t}});return d(o.NextResponse.json({success:!0,ticket:i}))}catch(t){let e=t instanceof Error?t.message:"Failed to process request";return d(o.NextResponse.json({error:e},{status:500}))}}async function l(){let e=await u.A.ticket.findMany({orderBy:{updatedAt:"desc"}});return d(o.NextResponse.json(e))}let g=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tickets/route",pathname:"/api/tickets",filename:"route",bundlePath:"app/api/tickets/route"},resolvedPagePath:"/Users/iwan/Downloads/New Chat/new-support/src/app/api/tickets/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:x,serverHooks:m}=g;function h(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:x})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(51485));module.exports=s})();