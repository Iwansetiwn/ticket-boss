(()=>{var e={};e.id=3799,e.ids=[3799],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},28124:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(60687),s=r(43210),n=r(16189),i=r(62781);function d({ticket:e}){let t=(0,n.useRouter)(),[r,d]=(0,s.useState)(e.clientName??""),[o,l]=(0,s.useState)(e.brand??""),[c,u]=(0,s.useState)(e.subject??""),[x,g]=(0,s.useState)(e.status||"Open"),[p,m]=(0,s.useState)(e.issueCategory||"Uncategorized"),[b,h]=(0,s.useState)(e.ticketUrl??""),[f,y]=(0,s.useState)(!1),[k,w]=(0,s.useState)(null),[v,j]=(0,s.useState)(null),N=(0,s.useMemo)(()=>!!(r.trim()&&o.trim()&&c.trim()),[o,r,c]),C=async a=>{if(a.preventDefault(),N&&!f){y(!0),w(null),j(null);try{let a=await fetch(`/api/tickets/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientName:r.trim(),brand:o.trim(),subject:c.trim(),status:x,issueCategory:p,ticketUrl:b.trim()})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error||"Failed to update ticket")}w("Ticket updated successfully."),t.refresh()}catch(e){j(e instanceof Error?e.message:"Failed to update ticket")}finally{y(!1)}}};return(0,a.jsx)("div",{className:"rounded-xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03]",children:(0,a.jsxs)("form",{className:"space-y-6",onSubmit:C,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Client name",(0,a.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",placeholder:"Client name"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Brand",(0,a.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",placeholder:"Brand"})]}),(0,a.jsxs)("label",{className:"col-span-full flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Subject",(0,a.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",placeholder:"Subject"})]}),(0,a.jsxs)("label",{className:"col-span-full flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Ticket link",(0,a.jsx)("input",{type:"url",inputMode:"url",value:b,onChange:e=>h(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",placeholder:"https://example.com/support/ticket"}),(0,a.jsx)("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400",children:"Used when opening the original ticket from this dashboard."})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Status",(0,a.jsx)("select",{value:x,onChange:e=>g(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",children:i.y.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:["Category",(0,a.jsx)("select",{value:p,onChange:e=>m(e.target.value),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-brand-400 focus:outline-none focus:ring-1 focus:ring-brand-400 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",children:i.c.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-center text-sm text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("span",{children:"Last updated"}),(0,a.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:new Intl.DateTimeFormat("en",{dateStyle:"medium",timeStyle:"short"}).format(new Date(e.lastUpdated))})]})]}),v&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:v}),k&&(0,a.jsx)("p",{className:"text-sm text-emerald-500",children:k}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:!N||f,className:"rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-brand-600 disabled:cursor-not-allowed disabled:bg-gray-300",children:f?"Saving...":"Save changes"})})]})})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32756:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,85814,23)),Promise.resolve().then(r.bind(r,48351)),Promise.resolve().then(r.bind(r,28124))},33873:e=>{"use strict";e.exports=require("path")},34239:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(37413);r(61120);var s=r(39916),n=r(4536),i=r.n(n),d=r(59065),o=r(75150),l=r(31183),c=r(12909),u=r(52822),x=r(97240);async function g({params:e}){var t;let r=await (0,c.HW)();r||(0,s.redirect)("/signin");let{id:n}=await e,g=await l.A.ticket.findFirst({where:{id:n,ownerId:r.id}});if(!g)return(0,s.notFound)();let p="extensionData"in g?g.extensionData:void 0,m=g.ticketUrl??(0,u.Q)(g.id),b=(0,x.Zz)(g.id);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Ticket #",b]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:g.subject||"No subject"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,a.jsx)(i(),{href:"/dashboard/tickets",className:"rounded-lg border border-gray-200 px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:"Back to tickets"}),(0,a.jsx)(i(),{href:m,target:"_blank",rel:"noopener noreferrer",className:"rounded-lg border border-gray-200 px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:"Open ticket ↗"}),(0,a.jsx)("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm font-medium ${"Open"===(t=g.status??"")?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/20 dark:text-emerald-400":"Pending"===t?"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"}`,children:g.status??"Unknown"}),(0,a.jsx)(d.default,{id:g.id,subject:g.subject??void 0})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-xl border border-gray-200 bg-white p-4 text-sm dark:border-white/[0.05] dark:bg-white/[0.03] sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-400 dark:text-gray-500",children:"Ticket link"}),(0,a.jsx)(i(),{href:m,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-semibold text-gray-700 transition hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200",children:"Open original ↗"})]}),(0,a.jsx)(o.default,{ticket:{id:g.id,clientName:g.clientName??"",brand:g.brand??"",subject:g.subject??"",status:g.status??"Open",issueCategory:g.issueCategory??"Uncategorized",lastUpdated:g.updatedAt.toISOString(),ticketUrl:g.ticketUrl??""}}),null!=p&&(0,a.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white p-6 dark:border-white/[0.05] dark:bg-white/[0.03]",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Extension data (raw)"}),(0,a.jsx)("pre",{className:"mt-2 max-h-64 overflow-auto rounded bg-gray-50 p-3 text-xs text-gray-700 dark:bg-gray-900 dark:text-gray-200",children:JSON.stringify(p,null,2)})]})]})}},48351:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(60687),s=r(43210),n=r(16189),i=r(19125);function d({id:e,subject:t}){let r=(0,n.useRouter)(),[d,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),[u,x]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[m,b]=(0,s.useState)(!1),h=(0,s.useRef)(null);function f(){l||o(!1)}async function y(){try{let t=await fetch(`/api/tickets/${e}`);if(!t.ok)return null;return(await t.json()).ticket}catch(e){return console.error("Failed to fetch ticket details",e),null}}function k(e,t,a){h.current&&window.clearTimeout(h.current),p({ticket:t,label:e,error:a}),h.current=window.setTimeout(()=>{p(null),h.current=null,r.push("/dashboard/tickets"),r.refresh()},3e3)}async function w(){x(null),c(!0);let r=await y();try{let a=await fetch(`/api/tickets/${e}`,{method:"DELETE"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error||"Failed to delete ticket")}o(!1);let s=t?`"${t}"`:`Ticket ${e}`;k(s,r)}catch(e){console.error("delete failed",e),x(e instanceof Error?e.message:"Failed to delete ticket")}finally{c(!1)}}async function v(){if(g?.ticket){h.current&&(window.clearTimeout(h.current),h.current=null),b(!0);try{let e=await fetch("/api/tickets/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticket:g.ticket})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t?.error||"Failed to restore ticket")}p(null),r.refresh()}catch(a){console.error("restore failed",a);let r=a instanceof Error?a.message:"Failed to undo delete";k(t?`"${t}"`:`Ticket ${e}`,g?.ticket??null,r)}finally{b(!1)}}}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{type:"button",onClick:function(){o(!0),x(null)},disabled:l,className:"rounded-lg border border-red-200 px-3 py-1 text-sm font-medium text-red-600 transition hover:bg-red-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-400 disabled:cursor-not-allowed disabled:opacity-60 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200 dark:hover:bg-red-500/20",children:"Delete"}),(0,a.jsx)(i.a,{isOpen:d,onClose:f,showCloseButton:!l,className:"max-w-md p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Delete this ticket?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"This permanently removes the ticket but you'll have three seconds to undo once confirmed."}),u&&(0,a.jsx)("div",{className:"rounded-xl bg-red-50 px-3 py-2 text-sm text-red-600 dark:bg-red-500/10 dark:text-red-200",children:u}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:f,disabled:l,className:"rounded-full px-4 py-2 text-sm font-semibold text-gray-600 transition hover:text-gray-900 disabled:opacity-50 dark:text-gray-300",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:w,disabled:l,className:"rounded-full bg-red-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-600 disabled:opacity-60",children:l?"Deleting…":"Delete"})]})]})}),g&&(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 z-[1100] w-full max-w-sm rounded-2xl border border-gray-200 bg-white p-4 shadow-2xl dark:border-gray-700 dark:bg-gray-900",children:[(0,a.jsx)("div",{className:"flex items-start gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Ticket deleted"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[g.label," removed. Undo is available for 3 seconds."]}),g.error&&(0,a.jsx)("p",{className:"mt-2 text-xs text-red-500 dark:text-red-400",children:g.error})]})}),(0,a.jsx)("div",{className:"mt-4 flex items-center justify-end gap-3",children:(0,a.jsx)("button",{onClick:v,disabled:!g.ticket||m||!!g.error,className:"rounded-full bg-brand-500 px-4 py-1.5 text-sm font-semibold text-white transition hover:bg-brand-600 disabled:opacity-60",children:m?"Restoring…":"Undo"})})]})]})}},52822:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s});var a=r(97240);function s(e){let t=process.env.NEXT_PUBLIC_WORLDHOST_SUPPORT_INBOX_URL??"https://admin.worldhost.group/admin/support/inbox",r=(0,a.Zz)(e);return`${t.replace(/\/$/,"")}/${r}`}},55511:e=>{"use strict";e.exports=require("crypto")},56724:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,4536,23)),Promise.resolve().then(r.bind(r,59065)),Promise.resolve().then(r.bind(r,75150))},58449:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>l});var a=r(65239),s=r(48088),n=r(88170),i=r.n(n),d=r(30893),o={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);r.d(t,o);let l={children:["",{children:["dashboard",{children:["tickets",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,34239)),"/Users/iwan/Downloads/New Chat/new-support/src/app/dashboard/tickets/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,63144)),"/Users/iwan/Downloads/New Chat/new-support/src/app/dashboard/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/Users/iwan/Downloads/New Chat/new-support/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"/Users/iwan/Downloads/New Chat/new-support/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/iwan/Downloads/New Chat/new-support/src/app/dashboard/tickets/[id]/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/dashboard/tickets/[id]/page",pathname:"/dashboard/tickets/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},59065:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/iwan/Downloads/New Chat/new-support/src/components/tickets/DeleteTicketButton.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/iwan/Downloads/New Chat/new-support/src/components/tickets/DeleteTicketButton.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75150:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/iwan/Downloads/New Chat/new-support/src/components/tickets/TicketEditForm.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/iwan/Downloads/New Chat/new-support/src/components/tickets/TicketEditForm.tsx","default")},79551:e=>{"use strict";e.exports=require("url")},96330:e=>{"use strict";e.exports=require("@prisma/client")},97240:(e,t,r)=>{"use strict";r.d(t,{WU:()=>i,Zz:()=>n,av:()=>d,gA:()=>l,ho:()=>o});let a="__day__",s=/^\d{4}-\d{2}-\d{2}$/;function n(e){if(!e)return e;let t=e.trim(),r=t.lastIndexOf(a);if(-1===r)return t;let n=t.slice(r+a.length);return s.test(n)?t.slice(0,r):t}function i(e){if(e){let t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return new Date}function d(e){return e.toISOString().slice(0,10)}function o(e,t){let r=e.trim(),s=d(t);return`${r}${a}${s}`}function l(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),r=new Date(t);return r.setUTCDate(r.getUTCDate()+1),{start:t,end:r}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,4999,7370,879,3409,9283],()=>r(58449));module.exports=a})();